
\chapter{Servidor de Percepciones}
 \label{chap:servidor_de_percepciones}

 El servidor de percepciones mantiene una conexíon abierta por cada agente
 Los métodos que manejan la conexión codifican los datos secuenciales en una 
 forma amena para operaciones sobre conjuntos, la cual es transmitida por la red.
 En cada turno, el servidor de percepciones espera los datos del agente, 
 realiza la union de todas las percepciones, y le devuelve a cada agente la 
 diferencia entre la percepcion global y su percepcion. 
 Las figuras \ref{fig:pythonperceptpublic} y \ref{fig:pythonperceptprivate}
 muestras ejemplos de percepciones despues de ser parseadas, y antes de enviar
 al servidor de percepciones.

 \begin{figure}
 \centering
 \begin{small}
 \begin{verbatim}
 { 'surveyed_edges' : [ ], 
   'vis_verts'      : [ { 'name': 'vertex65',  
                          'team': 'none' }, 
                        ...  ],  
   'vis_ents'       : [ { 'node':   'vertex97',  
                          'status': 'normal', 
                          'name':   'a6',  
                          'team':   'A' }, 
                          ...  ],  
   'inspected_ents' : [ ],  
   'vis_edges'      : [ { 'node1': 'vertex141', 
                          'node2': 'vertex65' }, 
                        ...  ], 
   'position'       : [ { 'node':       'vertex141', 
                          'vis_range':  '1', 
                          'health':     '6', 
                          'name':       'self', 
                          'max_health': '6' } ], 
   'probed_verts'   : [ ] }
 \end{verbatim}
 \end{small}
 \caption{Una muestra de la sección pública de una percepción, despues del parseo.}
 \label{fig:pythonperceptpublic}
 \end{figure}
 
 \begin{figure}
 \begin{verbatim}
 { 'total_time':      2000L, 'zone_score': '0',            
   'last_step_score': '20',  'timestamp':  '1323732915832',       
   'strength':        '0',   'energy':     '11',                  
   'money':           '12',  'max_energy_disabled': '16',                  
   'last_action':     'recharge', 'max_health':     '6',
   ... }
 \end{verbatim}
 \caption{A sample private section of a percept.}
 \label{fig:pythonperceptprivate}
 \end{figure}

%--------------------------------------------CONEXION PERCEPT-SERVER-%
\section[Conexión con el Percept Server]
 {Conexión del Agente con el Servidor de Percepciones}
 \label{sec:conexion}

 TODO

%---------------------------------------------------FORMATO PERCEPTS-%
\section{Formato de mensajes}
 \label{sec:formato_mensajes}

 TODO

%-------------------------------------------PROTOCOLO PERCEPT-SERVER-%
\section[Protocolo del Percept Server]
 {Protocolo de Comunicación con el Servidor de Percepciones}
 \label{sec:protocolo_perceptserver}

 TODO

\subsection{Esquema de Codificación}
 \label{sub:esquema_codificacion}

 Tras la recepción de la percepción del servidor, el parseo del XML y
 su transformación en diccionarios nativos de Python, el agente
 retransmite la informacion recibida al servidor de percepciones.
 Aunque es factible enviar la percepcón en formato XML o como la
 representación de la estructura de datos en memoria del agente, unos
 de los objetivos es distribuir tanto como posible el trabajo realizado
 por el sistema.
 Como las tareas principales realizadas por el servidor de percepciones 
 son la union de la información y la diferencia de cada percepción 
 individual con el total, se implemento un esquema más de codificacion. 
 Se transforma el diccionario que contiene la percepción en una 
 estructura sobre la cual se pueden realizar operaciones de conjunto de 
 manera eficiente. 

 TODO

\subsection{Esquema de Reconexión para Agentes Caidos}
 \label{sub:esquema_reconexion}
 
 Si el agente pierde la conexión, 
 
\subsection{Evaluación de Performance}
 \label{sub:evaluacion_performance}
